<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"></meta>
<title>Hello World</title>
<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
	crossorigin="anonymous" />

<style type="text/css">
</style>
</head>
<body>
	<form action="" id="formcadastrouser"
		style="padding-left: 10px; padding-top: 20px; width: 400px; margin: auto; background-color: #ddffff; margin-top: 80px;">
		<div class="mb-3">
			<label for="id" style="color: red;">Id:</label> <input type="text"
				class="form-control" id="id" readonly="readonly"
				style="width: 380px;" />
		</div>
		<div class="mb-3">
			<label for="nome" style="color: red;">Nome:</label> <input
				type="text" class="form-control" id="nome"
				placeholder="Informe o Nome" required="required"
				style="width: 380px;" />
		</div>
		<div class="mb-3">
			<label for="idade" style="color: red;">Idade:</label> <input
				type="number" class="form-control" id="idade"
				placeholder="Informe a Idade" required="required"
				style="width: 380px;" />
		</div>

		<button type="button"
			class="btn btn-primary btn-round waves-effect waves-light"
			onclick="salvarUsuario();" id="btnSave">Salvar</button>
		<button type="button"
			class="btn btn-warning btn-round waves-effect waves-light"
			onclick="document.getElementById('formcadastrouser').reset();">Novo</button>
		<button type="button"
			class="btn btn-danger btn-round waves-effect waves-light"
			onclick="botaoDeletarDaTela();">Deletar</button>
		<button type="button"
			class="btn btn-success btn-round waves-effect waves-light "
			data-bs-toggle="modal" data-bs-target="#modalPesquisaUser">Pesquisar</button>

	</form>


	<!-- Modal -->

	<div class="modal fade" id="modalPesquisaUser" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Pesquisar
						Usuário</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form>
						<div class="mb-3">
							<label for="nameBusca" class="col-form-label">Informe o
								nome:</label> <input type="text" class="form-control" id="nameBusca" />
						</div>
						<button type="button" class="btn btn-success"
							onclick="pesquisaUser();">Buscar</button>
					</form>
					<div style="height: 300px; overflow: scroll;">
						<table class="table" id="tabelaresultado">
							<thead>
								<tr>
									<th scope="col">ID</th>
									<th scope="col">Nome</th>
									<th scope="col">Editar</th>
									<th scope="col">Delete</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
				<span id="totalresultados"></span>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Fechar</button>

				</div>
			</div>
		</div>
	</div>
	<!-- Fim Modal  -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"
		integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
		crossorigin="anonymous"></script>
	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
		crossorigin="anonymous"></script>
	<script type="text/javascript">
	// <![CDATA[
	

		function pesquisaUser() {
			var nome = $('#nameBusca').val();
			if (nome!=' null' && nome.trim() != '') {
				$
						.ajax(
								{
									method : 'GET',
									url : 'buscarPorNome',
									data : 'name=' + nome,
									success : function(response) {
										$('#tabelaresultado > tbody > tr')
												.remove();
										for (var i = 0; i < response.length; i++) {
											$('#tabelaresultado > tbody')
													.append(
															'<tr id="' + response[i].id + '"><td>'
																	+ response[i].id
																	+ '</td><td>'
																	+ response[i].nome
																	+ '</td><td><button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="colocarEmEdicao('
																	+ response[i].id
																	+ ')">Ver</button></td><td><button type="button" class="btn btn-danger btn-round waves-effect waves-light" onclick="deleteUser('
																	+ response[i].id
																	+ ')">Delete</button></td></tr>');
										}
										document
												.getElementById('totalresultados').textContent = 'Resultado: '
												+ response.length;
									}
								}).fail(function(xhr, status, errorThrow) {
							alert("Erro ao Buscar: " + xhr.responseText);
						});
			}
		}

		function colocarEmEdicao(id) {
			$.ajax({
				method : 'GET',
				url : 'buscaruserid',
				data : 'idUser=' + id,
				success : function(response) {
					$('#id').val(response.id);
					$('#nome').val(response.nome);
					$('#idade').val(response.idade);
					//$('#modalPesquisaUser').modal('hide');
				}
			}).fail(function(xhr, status, errorThrow) {
				alert("Erro ao buscar usuário por id: " + xhr.responseText);
			});
		}

		function deleteUser(id) {
			if (confirm('Deseja realmente deletar?')) {

				$.ajax({
					method : 'DELETE',
					url : 'delete',
					data : 'idUser=' + id,
					success : function(response) {
						$('#' + id).remove();
						alert('Usuário deletado com sucesso!');
					}
				}).fail(
						function(xhr, status, errorThrow) {
							alert("Erro ao deletar usuário por id: "
									+ xhr.responseText);
						});
			}
		}

		function botaoDeletarDaTela() {
			var id = $('#id').val();
			if (id != null && id.trim() != '') {
				deleteUser(id);
				document.getElementById('formcadastrouser').reset();
				alert('Usuário deletado com sucesso!');
			} else {
				alert('Não é possível deletar!');
			}
		}

		function salvarUsuario() {
			var id = $("#id").val();
			var nome = $("#nome").val();
			var idade = $("#idade").val();
			if (nome == null || nome != null && nome.trim() == '') {
				$('#nome').focus();
				alert('Informe o nome!');
				return;
			}

			if (idade == null || idade != null && idade.trim() == '') {
				$('#idade').focus();
				alert('Informe a idade!');
				return;
			}
			$.ajax({
				method : "POST",
				url : "salvar",
				data : JSON.stringify({
					id : id,
					nome : nome,
					idade : idade
				}),
				contentType : "application/json; charset=utf-8",
				success : function(response) {
					$("#id").val(response.id);

					alert("Salvo com sucesso!");
				}
			}).fail(function(xhr, status, errorThrow) {
				alert("Erro ao Salvar: " + xhr.responseText);
			});
		}
		function mudar() {
			var id = $("#id").val();
			var texto = document.querySelector('#btnSave');
			if (id != null && id.trim() != '') {
				texto.textContent = 'Atualizar';
				texto.style.background - color == 'red';
			} else if (id == null && id.trim() == '') {
				texto.textContent = 'Salvar';
				texto.style.background - color == 'blue';
			}
		}
		// ]]>
	</script>
</body>
</html>